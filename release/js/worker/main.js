define(["require","exports","./ava","../shared/model"],function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){return function(e,t){this.stp=e,this.deviceIdMap=t}}(),i=function(){function e(){}return e.prototype.expandModel=function(e){var t=new r.Stp,i={},s={},o=[];i[e.stp.id]=t.getRootDevice(),s[e.stp.id]=t.getRootService();for(var d=0,v=e.devices;d<v.length;d++){var p=v[d],u=t.newDevice(p.ava,p.selfRedundant);i[p.id]=u,o[u.id()]=p.id;for(var c=0,l=p.services;c<l.length;c++){var f=l[c];s[f.id]=u.newService(f.name,f.capacity)}}for(var g=0,h=e.links;g<h.length;g++){var m=h[g];m.type===n.LinkType.Device?i[m.from].link(i[m.to]):m.type===n.LinkType.Service&&s[m.from].addChild(s[m.to])}return new a(t,o)},e.prototype.run=function(e,t,r,a){var i=this.expandModel(e),s=i.stp.calculate(t,r,a),o=s.singlePointsOfFailure.map(function(e){return i.deviceIdMap[e]});return new n.SimResult(s.availability,o,s.error)},e}();t.Worker=i;var s=new i;self.addEventListener("message",function(e){postMessage({event:"start"});var t=JSON.parse(e.data.model,n.inflater),r=s.run(t,e.data.numThreads,e.data.thisThreadNumber,function(e,t){var r=Math.floor(100*e/t);r>0&&postMessage({event:"progress",progress:r})});postMessage({event:"progress",progress:100}),postMessage({event:"done",result:JSON.stringify(r)})},!1)});
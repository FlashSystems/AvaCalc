define(["require","exports","./ava","../shared/model"],function(e,r,t,n){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),importScripts("../js/require.js");var i;!function(e){var r=function(){return function(e,r){this.stp=e,this.deviceIdMap=r}}(),i=function(){function e(){}return e.prototype.expandModel=function(e){var i=new t.Stp,a={},s={},o=[];a[e.stp.id]=i.getRootDevice(),s[e.stp.id]=i.getRootService();for(var d=0,p=e.devices;d<p.length;d++){var v=p[d],u=i.newDevice(v.ava,v.selfRedundant);a[v.id]=u,o[u.id()]=v.id;for(var c=0,f=v.services;c<f.length;c++){var l=f[c];s[l.id]=u.newService(l.name,l.capacity)}}for(var g=0,h=e.links;g<h.length;g++){var m=h[g];m.type===n.LinkType.Device?a[m.from].link(a[m.to]):m.type===n.LinkType.Service&&s[m.from].addChild(s[m.to])}return new r(i,o)},e.prototype.run=function(e,r,t,i){var a=this.expandModel(e),s=a.stp.calculate(r,t,i),o=s.singlePointsOfFailure.map(function(e){return a.deviceIdMap[e]});return new n.SimResult(s.availability,o,s.error)},e}();e.Worker=i}(i||(i={}));var a=new i.Worker;self.addEventListener("message",function(e){postMessage({event:"start"});var r=JSON.parse(e.data.model,n.inflater),t=a.run(r,e.data.numThreads,e.data.thisThreadNumber,function(e,r){var t=Math.floor(100*e/r);t>0&&postMessage({event:"progress",progress:t})});postMessage({event:"progress",progress:100}),postMessage({event:"done",result:JSON.stringify(t)})},!1)});